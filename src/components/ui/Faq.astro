---
export interface Props {
  class?: string;
  faqItems?: Array<{
    question: string;
    answer: string;
    isExpanded?: boolean;
    cta?: {
      text: string;
      href?: string;
    };
  }>;
}

const { 
  class: className = "",
  faqItems = []
} = Astro.props;

const containerClasses = `box-border content-stretch flex flex-col items-start justify-start p-0 relative w-full ${className}`;
---

<div class={containerClasses}>
  {faqItems.map((item, index) => (
    <div 
      class="relative shrink-0 w-full cursor-pointer"
      x-data={`{ 
        isOpen: ${item.isExpanded || false},
        index: ${index}
      }`}
      @click="isOpen = !isOpen"
    >
      <div class="box-border content-stretch flex flex-col items-start justify-start overflow-clip px-0 py-8 relative w-full">
        <div class="box-border content-stretch flex flex-col items-start justify-start p-0 relative shrink-0 w-full">
          <!-- Question Header -->
          <div
            class="box-border content-stretch flex flex-row items-center justify-between p-0 relative shrink-0 w-full group focus:outline-none focus-visible:ring-2 focus-visible:ring-[color:var(--primary)] focus-visible:ring-offset-2 rounded-lg"
            :aria-expanded="isOpen"
            :aria-controls="`faq-content-${this.index}`"
          >
            <h3 class="font-[500] leading-[1.15] not-italic relative shrink-0 text-[color:var(--text)] text-[25px] md:text-[28px] lg:text-[34px] text-left tracking-[-0.015em] group-hover:opacity-[0.8] transition-opacity duration-200">
              {item.question}
            </h3>
            <div class="relative shrink-0 size-8 flex items-center justify-center">
              <!-- Plus icon (when closed) -->
              <svg 
                x-show="!isOpen"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 rotate-90"
                x-transition:enter-end="opacity-100 rotate-0"
                xmlns="http://www.w3.org/2000/svg" 
                width="32" 
                height="32" 
                viewBox="0 0 32 32" 
                fill="none"
                class="text-[color:var(--text)] group-hover:opacity-[0.8] transition-opacity duration-200"
              >
                <path d="M16 8V24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M8 16H24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              
              <!-- Minus icon (when open) -->
              <svg 
                x-show="isOpen"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 rotate-90"
                x-transition:enter-end="opacity-100 rotate-0"
                xmlns="http://www.w3.org/2000/svg" 
                width="32" 
                height="32" 
                viewBox="0 0 32 32" 
                fill="none"
                class="text-[color:var(--text)] group-hover:opacity-[0.8] transition-opacity duration-200"
              >
                <path d="M8 16H24" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </div>
          </div>

          <!-- Answer Content -->
          <div 
            x-show="isOpen"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0 max-h-0"
            x-transition:enter-end="opacity-100 max-h-96"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100 max-h-96"
            x-transition:leave-end="opacity-0 max-h-0"
            :id="`faq-content-${this.index}`"
            role="region"
            :aria-labelledby="`faq-question-${this.index}`"
            class="overflow-hidden"
          >
            <div class="bg-transparent h-5 opacity-0 shrink-0 w-full"></div>
            <div class="font-normal leading-[150%] not-italic relative shrink-0 text-[color:var(--text)] text-[16px] md:text-[18px] lg:text-[20px] text-left tracking-[0.01em] max-w-[575px]">
              <p class="leading-[150%]">
                {item.answer}
              </p>
            </div>

            {item.cta && (
              <>
                <div class="bg-transparent h-6 opacity-0 shrink-0 w-full"></div>
                <a
                  href={item.cta.href || "#"}
                  class="box-border content-stretch flex flex-row gap-3 items-center justify-start p-0 relative shrink-0 group hover:opacity-[0.8] transition-opacity duration-200"
                >
                  <span class="font-normal leading-[150%] not-italic relative shrink-0 text-[color:var(--text)] text-[16px] text-left text-nowrap tracking-[0.01em] group-hover:opacity-[0.8] transition-opacity duration-200">
                    {item.cta.text}
                  </span>
                  <div class="box-border content-stretch flex flex-row gap-2.5 items-center justify-center p-0 relative shrink-0 size-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" class="text-[color:var(--text)] group-hover:opacity-[0.8] transition-opacity duration-200">
                      <path d="M3 8H13" stroke="currentColor" stroke-width="1.2" stroke-linecap="square" stroke-linejoin="round"/>
                      <path d="M10 4L14 8L10 12" stroke="currentColor" stroke-width="1.2" stroke-linecap="square"/>
                    </svg>
                  </div>
                </a>
              </>
            )}
          </div>
        </div>
      </div>
      <div class="absolute border-[color:var(--card-border)] border-[0px_0px_1px] border-solid inset-0 pointer-events-none"></div>
    </div>
  ))}
</div>
